(window.webpackJsonp=window.webpackJsonp||[]).push([[1,2],{"88wP":function(e,t,s){"use strict";var r=s("mrSG"),d=s("YKMj"),i=s("CswO"),a=s("vDqi"),o=s.n(a),n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.c)(t,e),t.prototype.saveAddressNative=function(e,t,s){return void 0===t&&(t=!1),void 0===s&&(s={}),Object(r.a)(this,void 0,void 0,(function(){var d,i,a;return Object(r.d)(this,(function(r){switch(r.label){case 0:return e.error=Object.assign({},this.resetFormObj),d=t?"patch":"post",i="/address",t&&(i+="/"+e.address.id),e.form.withTrans=s.withTrans,[4,o.a[d](i,e.form)];case 1:return(a=r.sent())&&422===a.status?(e.hasErrors=!0,e.error=a.data.errors,this.error(),[2,null]):!a||!a.data||a.status>204?(this.error(),[2,null]):[2,a.data]}}))}))},t.prototype.validateData=function(e){e.addressChecked=!1;if(!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.form.userMail)&&!e.userId)return!0;if(/!\(([0-9]{2}|0{1}((x|[0-9]){2}[0-9]{2}))\)\s*[0-9]{3,4}[- ]*[0-9]{4}/.test(e.form.phoneNumber))return!0;var t=e.form;return!(t.firstName.length||t.lastName.length||t.address.length||t.country.length||t.city.length||t.postCode.length||t.phoneNumber.length)},Object.defineProperty(t.prototype,"resetFormObj",{get:function(){return Object.assign({},{id:0,userMail:"",firstName:"",lastName:"",address:"",dep:"",city:"",country:"",gov:"",postCode:"",phoneNumber:"",notes:""})},enumerable:!1,configurable:!0}),t=Object(r.b)([d.a],t)}(i.a);t.a=n},L85r:function(e,t,s){"use strict";s.r(t);var r=s("mrSG"),d=s("YKMj"),i=s("vDqi"),a=s.n(i),o=s("rRdG"),n=s("88wP"),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.d={cart:{items:[],loaders:[1,2,3,4],wish:[],count:0,total:0},cartLoader:!0,wishLoader:!0,q:"",userId:0,scrollTop:0,items:[],orderId:"",creating:!1,form:o.FormInpts,error:o.FormInpts,address:o.FormInpts,hasErrors:!1,addressChecked:!1,profile:{img:{},prev:"",hasErr:!1,errors:{img:[]},uploading:!1},completing:!1},t}return Object(r.c)(t,e),t.prototype.openItemsModal=function(e,t){this.d.items=Object(r.f)(JSON.parse(e||"[]")),this.d.orderId=t;var s=document.getElementById("items-modal");s&&new Modal(s).show()},t.prototype.createAddress=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var s=document.getElementById("address-form-modal");if(this.d.form=t?this.d.address:this.resetFormObj,this.d.error=this.resetFormObj,s){if(e)return new Modal(s).hide();new Modal(s).show()}},t.prototype.saveAddress=function(){var e=this;if(this.d.hasErrors=this.validateData(this.d),!this.d.creating&&!this.d.hasErrors){console.log(this.d.address);var t=this.d.address.id>0;this.d.creating=!0,this.saveAddressNative(this.d,t,{withTrans:!0}).then((function(s){if(!s||!t&&!s.address||t&&s.address)return e.d.creating=!1,void e.error();t?location.reload():e.createAddressElem(s),e.createAddress(!0),e.d.address=e.resetFormObj,e.d.creating=!1,e.d.form=e.resetFormObj,document.querySelector("#emptyMess").classList.add("d-none")}))}},t.prototype.editAddress=function(e){this.d.address=JSON.parse(e||"{}"),this.createAddress(!1,!0)},t.prototype.deleteAddress=function(e){var t=this,s=document.querySelector("#spinnerDelete"+e);s&&!s.classList.contains("d-none")||(this.showLoader("spinnerDelete"+e),a.a.delete("/address/"+e).then((function(s){if(!s||204!==s.status)return t.error(),void t.hideLoader("spinnerDelete"+e);t.hideLoader("address"+e),t.hideLoader("spinnerDelete"+e)})))},t.prototype.validateOnChange=function(){this.d.hasErrors=this.validateData(this.d)},t.prototype.previewImg=function(e){var t=this,s=e.target;if(s.files&&s.files[0]){this.d.profile.img=s;var r=new FileReader;r.onload=function(e){t.d.profile.prev=e.target.result},r.readAsDataURL(s.files[0])}else this.d.profile.prev=""},t.prototype.uploadImage=function(){var e,t,s=this;this.d.profile.uploading||!(null===(e=this.d.profile.img)||void 0===e?void 0:e.files)||null===(t=this.d.profile.img)||void 0===t||t.files[0],this.d.profile.uploading=!0;var r=new FormData;r.append("img",this.d.profile.img.files[0]),a.a.post("/user/profile/image",r,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){return e&&e.data?422===e.status?(s.d.profile.hasErr=!0,s.d.profile.errors.img=e.data.errors.img,void(s.d.profile.uploading=!1)):(s.d.profile.uploading=!1,s.success(),s.d.profile.prev="",s.d.profile.img={},s.updateBgImage(".nav-right .x-pimg",e.data.img),s.updateBgImage(".navbar .x-pimg",e.data.img),void s.updateBgImage(".sidebar .x-pimg",e.data.img)):(s.error(),void(s.d.profile.uploading=!1))}))},t.prototype.deleteRate=function(e){var t=this,s=document.getElementById("spinner"+e),r=document.getElementById("rateid"+e);s.parentElement.classList.contains("disabled"),s.parentElement.classList.add("disabled"),s.classList.remove("d-none"),a.a.delete("/rates/"+e).then((function(e){if(!e||204!==e.status)return t.error(),s.parentElement.classList.remove("disabled"),void s.classList.add("d-none");s.parentElement.classList.remove("disabled"),s.classList.add("d-none"),t.success(),r.parentElement.classList.add("d-none")}))},t.prototype.updateBgImage=function(e,t){var s=document.querySelector(e);s&&(s.style.backgroundImage="url(/"+t+")")},t.prototype.createAddressElem=function(e){var t=document.createElement("div");t.id="address"+e.id,t.classList.add("col-md-6","mb-3");var s=document.createElement("address");s.innerHTML="<div class='card card-body'><h5>"+e.firstName+" "+e.lastName+"</h5> ("+("number"==typeof e.dep?e.dep:"")+") "+e.address+" "+e.city+"<br> <strong>"+e.gov+", "+e.country+'</strong><br>\n        <a class="mt-2" href="tel:'+e.phoneNumber+'">\n    <i class="fas fa-phone-alt mx-1"></i>\n    '+e.phoneNumber+"\n</a></div>",t.append(s),document.querySelector("#address-list-row").prepend(t)},t.prototype.showLoader=function(e){var t=document.querySelector("#"+e);t&&t.classList.remove("d-none")},t.prototype.hideLoader=function(e){var t=document.querySelector("#"+e);t&&t.classList.add("d-none")},t.prototype.completeOrder=function(e){var t=this,s=document.querySelector("#spinord"+e),r=s.parentElement;s.classList.contains("d-none")&&(r.classList.add("disabled"),s.classList.remove("d-none"),a.a.post("/track/"+e+"/complete").then((function(e){if(!e||!e.data||!e.data.updated)return t.error(),r.classList.remove("disabled"),void s.classList.add("d-none");r.classList.remove("disabled"),s.classList.add("d-none"),t.success(),r.classList.add("d-none")})))},Object.defineProperty(t.prototype,"resetFormObj",{get:function(){return{id:0,userMail:"",firstName:"",lastName:"",address:"",dep:"",city:"",country:"",gov:"",postCode:"",phoneNumber:"",notes:""}},enumerable:!1,configurable:!0}),t.prototype.beforeMount=function(){this.attachToGlobal(this,["openItemsModal","editAddress","deleteAddress","createAddress","saveAddress","validateOnChange","previewImg","uploadImage","deleteRate","completeOrder"])},t=Object(r.b)([d.a],t)}(Object(d.b)(n.a));t.default=c},rRdG:function(e,t,s){"use strict";s.r(t),s.d(t,"FormInpts",(function(){return n})),s.d(t,"EmptyOrder",(function(){return c}));var r=s("mrSG"),d=s("YKMj"),i=s("vDqi"),a=s.n(i),o=s("88wP"),n={id:0,userMail:"",firstName:"",lastName:"",address:"",dep:"",city:"",country:"",gov:"",postCode:"",phoneNumber:"",notes:""},c={id:0,orderNum:"",user_id:0,userMail:"",address_id:0,status:"",total:0,qty:0,paymentMethod:"",paymentStatus:!1},h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.d={cart:{items:[],wish:[],count:-5,total:0},cartLoader:!0,wishLoader:!0,q:"",form:n,error:n,continue:!1,address:n,order:c,updaingOrder:!1,paymentMethod:"onDelivery",orderSuccess:!1,userId:0,addresses:[],addressesLoader:[1,2,3,4],loadingAdresses:!0,emptyAddressList:!1,addingAddress:!1,showForm:!1,pageInx:0,scrollTop:0,hasErrors:!1,deletingAddress:!1,savingOrder:!1,addressChecked:!1,userMail:""},t}return Object(r.c)(t,e),t.prototype.addAddress=function(){var e=this;this.d.hasErrors=this.validateData(this.d),this.d.continue||this.d.hasErrors||this.d.order.id||(this.d.continue=!0,this.d.address.id?this.saveAddress(!0).then((function(t){e.success()})):(this.d.form.check=!0,this.saveAddress().then((function(t){t&&e.success()}))))},t.prototype.loadAddresses=function(){return Object(r.a)(this,void 0,void 0,(function(){var e;return Object(r.d)(this,(function(t){switch(t.label){case 0:return this.d.loadingAdresses=!0,[4,a.a.get("/user/"+this.d.userId+"/addresses")];case 1:return(e=t.sent())&&e.data&&e.data.ads?(this.d.form.userMail=e.data.userMail,this.d.userMail=e.data.userMail,e.data.ads.length?(this.d.addressesLoader=[],this.d.addresses=e.data.ads,this.d.error=Object.assign({},this.resetFormObj),this.d.loadingAdresses=!1,[2]):(this.d.emptyAddressList=!0,this.d.loadingAdresses=!1,[2])):(this.error(),this.d.loadingAdresses=!1,[2])}}))}))},t.prototype.selectAddress=function(e){this.d.error=Object.assign({},this.resetFormObj),this.d.form=Object.assign({},e),this.d.address=e,this.d.addressChecked=!0},t.prototype.validateOnChange=function(){this.d.hasErrors=this.validateData(this.d)},t.prototype.showAddressForm=function(){this.d.form=Object.assign({},this.resetFormObj),this.d.address=Object.assign({},this.resetFormObj),this.d.showForm=!0},t.prototype.deleteAddress=function(){var e=this;!this.d.deletingAddress&&this.d.address.id&&(this.d.deletingAddress=!0,a.a.delete("/address/"+this.d.address.id).then((function(t){if(!t||204!==t.status)return e.error(e.getLang(1),e.getLang(13)),void(e.d.deletingAddress=!1);var s=e.d.addresses.findIndex((function(t){return t.id===e.d.address.id}));e.d.addresses.splice(s,1),e.success(),e.d.deletingAddress=!1})))},t.prototype.saveAddress=function(e){return void 0===e&&(e=!1),Object(r.a)(this,void 0,void 0,(function(){var t,s=this;return Object(r.d)(this,(function(d){switch(d.label){case 0:return[4,this.saveAddressNative(this.d,e)];case 1:return(t=d.sent())?(e?this.d.addresses=Object(r.f)(this.d.addresses).map((function(e){if(e.id===s.d.address.id){var t=Object.assign({},s.d.form);delete t.userMail,t.id=e.id,e=t}return e})):(this.d.address=t,this.d.addresses.push(t)),this.d.hasErrors=!1,this.d.addressChecked=!0,this.d.continue=!1,this.d.form.check,[2,t]):(this.d.continue=!1,this.d.savingOrder=!1,[2])}}))}))},t.prototype.storeOrder=function(){var e=this;if(!this.d.savingOrder&&this.d.address.address){if(this.d.savingOrder=!0,this.d.form.userMail.length||(this.d.form.userMail=this.d.userMail),"accept"===this.d.paymentMethod){var t=Object(r.f)(this.d.cart.items),s=this.d.form;return a.a.post("/order/payment",{address:s,userMail:this.d.form.userMail,total:this.d.cart.total,qty:this.d.cart.count,paymentMethod:this.d.paymentMethod,items:t}).then((function(t){if(!t||!t.data||!t.data.uri)return e.d.savingOrder=!1,void e.error();location.href=t.data.uri}))}if(this.d.form.check=!1,this.d.address.id)return this.saveOrder();this.saveAddress().then((function(t){t&&e.saveOrder()})).catch((function(t){e.d.savingOrder=!1}))}},t.prototype.saveOrder=function(){return Object(r.a)(this,void 0,void 0,(function(){var e,t;return Object(r.d)(this,(function(s){switch(s.label){case 0:return e=Object(r.f)(this.d.cart.items),[4,a.a.post("/order",{address_id:this.d.address.id,userMail:this.d.form.userMail,total:this.d.cart.total,qty:this.d.cart.count,paymentMethod:this.d.paymentMethod,items:e})];case 1:return(t=s.sent())&&t.data&&200===t.status?(this.d.savingOrder=!1,this.d.order=t.data,this.d.order.id=t.data.enc_id,this.d.cart.items.splice(0),this.d.cart.total=0,this.d.cart.count=0,this.success(),[2]):(this.d.savingOrder=!1,this.error(),[2])}}))}))},t.prototype.showTab=function(e){var t=document.getElementById(e);t&&new Tab(t,{height:!0}).show()},t.prototype.beforeMount=function(){this.attachToGlobal(this,["addAddress","updateOrder","selectAddress","addAddress","addOrderWithoutAddress","validateOnChange","showAddressForm","deleteAddress","showTab","storeOrder"])},t.prototype.mounted=function(){var e=this;this.$on("cartDone",(function(){e.d.userId?e.loadAddresses():(e.d.showForm=!0,e.d.addressesLoader=[])})),this.d.form.country="eg",this.d.form.gov="ca"},t=Object(r.b)([d.a],t)}(Object(d.b)(o.a));t.default=h}}]);
//# sourceMappingURL=1.js.map