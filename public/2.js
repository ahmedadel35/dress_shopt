(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"88wP":function(s,t,e){"use strict";var r=e("mrSG"),d=e("YKMj"),i=e("CswO"),a=e("vDqi"),o=e.n(a),n=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return Object(r.c)(t,s),t.prototype.saveAddressNative=function(s,t,e){return void 0===t&&(t=!1),void 0===e&&(e={}),Object(r.a)(this,void 0,void 0,(function(){var d,i,a;return Object(r.d)(this,(function(r){switch(r.label){case 0:return s.error=Object.assign({},this.resetFormObj),d=t?"patch":"post",i="/address",t&&(i+="/"+s.address.id),s.form.withTrans=e.withTrans,[4,o.a[d](i,s.form)];case 1:return(a=r.sent())&&422===a.status?(s.hasErrors=!0,s.error=a.data.errors,this.error(),[2,null]):!a||!a.data||a.status>204?(this.error(),[2,null]):[2,a.data]}}))}))},t.prototype.validateData=function(s){s.addressChecked=!1;if(!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(s.form.userMail)&&!s.userId)return!0;if(/!\(([0-9]{2}|0{1}((x|[0-9]){2}[0-9]{2}))\)\s*[0-9]{3,4}[- ]*[0-9]{4}/.test(s.form.phoneNumber))return!0;var t=s.form;return!(t.firstName.length||t.lastName.length||t.address.length||t.country.length||t.city.length||t.postCode.length||t.phoneNumber.length)},Object.defineProperty(t.prototype,"resetFormObj",{get:function(){return Object.assign({},{id:0,userMail:"",firstName:"",lastName:"",address:"",dep:"",city:"",country:"",gov:"",postCode:"",phoneNumber:"",notes:""})},enumerable:!1,configurable:!0}),t=Object(r.b)([d.a],t)}(i.a);t.a=n},rRdG:function(s,t,e){"use strict";e.r(t),e.d(t,"FormInpts",(function(){return n})),e.d(t,"EmptyOrder",(function(){return h}));var r=e("mrSG"),d=e("YKMj"),i=e("vDqi"),a=e.n(i),o=e("88wP"),n={id:0,userMail:"",firstName:"",lastName:"",address:"",dep:"",city:"",country:"",gov:"",postCode:"",phoneNumber:"",notes:""},h={id:0,orderNum:"",user_id:0,userMail:"",address_id:0,status:"",total:0,qty:0,paymentMethod:"",paymentStatus:!1},c=function(s){function t(){var t=null!==s&&s.apply(this,arguments)||this;return t.d={cart:{items:[],wish:[],count:-5,total:0},cartLoader:!0,wishLoader:!0,q:"",form:n,error:n,continue:!1,address:n,order:h,updaingOrder:!1,paymentMethod:"onDelivery",orderSuccess:!1,userId:0,addresses:[],addressesLoader:[1,2,3,4],loadingAdresses:!0,emptyAddressList:!1,addingAddress:!1,showForm:!1,pageInx:0,scrollTop:0,hasErrors:!1,deletingAddress:!1,savingOrder:!1,addressChecked:!1,userMail:""},t}return Object(r.c)(t,s),t.prototype.addAddress=function(){var s=this;this.d.hasErrors=this.validateData(this.d),this.d.continue||this.d.hasErrors||this.d.order.id||(this.d.continue=!0,this.d.address.id?this.saveAddress(!0).then((function(t){s.success()})):(this.d.form.check=!0,this.saveAddress().then((function(t){t&&s.success()}))))},t.prototype.loadAddresses=function(){return Object(r.a)(this,void 0,void 0,(function(){var s;return Object(r.d)(this,(function(t){switch(t.label){case 0:return this.d.loadingAdresses=!0,[4,a.a.get("/user/"+this.d.userId+"/addresses")];case 1:return(s=t.sent())&&s.data&&s.data.ads?(this.d.form.userMail=s.data.userMail,this.d.userMail=s.data.userMail,s.data.ads.length?(this.d.addressesLoader=[],this.d.addresses=s.data.ads,this.d.error=Object.assign({},this.resetFormObj),this.d.loadingAdresses=!1,[2]):(this.d.emptyAddressList=!0,this.d.loadingAdresses=!1,[2])):(this.error(),this.d.loadingAdresses=!1,[2])}}))}))},t.prototype.selectAddress=function(s){this.d.error=Object.assign({},this.resetFormObj),this.d.form=Object.assign({},s),this.d.address=s,this.d.addressChecked=!0},t.prototype.validateOnChange=function(){this.d.hasErrors=this.validateData(this.d)},t.prototype.showAddressForm=function(){this.d.form=Object.assign({},this.resetFormObj),this.d.address=Object.assign({},this.resetFormObj),this.d.showForm=!0},t.prototype.deleteAddress=function(){var s=this;!this.d.deletingAddress&&this.d.address.id&&(this.d.deletingAddress=!0,a.a.delete("/address/"+this.d.address.id).then((function(t){if(!t||204!==t.status)return s.error(s.getLang(1),s.getLang(13)),void(s.d.deletingAddress=!1);var e=s.d.addresses.findIndex((function(t){return t.id===s.d.address.id}));s.d.addresses.splice(e,1),s.success(),s.d.deletingAddress=!1})))},t.prototype.saveAddress=function(s){return void 0===s&&(s=!1),Object(r.a)(this,void 0,void 0,(function(){var t,e=this;return Object(r.d)(this,(function(d){switch(d.label){case 0:return[4,this.saveAddressNative(this.d,s)];case 1:return(t=d.sent())?(s?this.d.addresses=Object(r.f)(this.d.addresses).map((function(s){if(s.id===e.d.address.id){var t=Object.assign({},e.d.form);delete t.userMail,t.id=s.id,s=t}return s})):(this.d.address=t,this.d.addresses.push(t)),this.d.hasErrors=!1,this.d.addressChecked=!0,this.d.continue=!1,this.d.form.check,[2,t]):(this.d.continue=!1,this.d.savingOrder=!1,[2])}}))}))},t.prototype.storeOrder=function(){var s=this;if(!this.d.savingOrder&&this.d.address.address){if(this.d.savingOrder=!0,this.d.form.userMail.length||(this.d.form.userMail=this.d.userMail),"accept"===this.d.paymentMethod){var t=Object(r.f)(this.d.cart.items),e=this.d.form;return a.a.post("/order/payment",{address:e,userMail:this.d.form.userMail,total:this.d.cart.total,qty:this.d.cart.count,paymentMethod:this.d.paymentMethod,items:t}).then((function(t){if(!t||!t.data||!t.data.uri)return s.d.savingOrder=!1,void s.error();location.href=t.data.uri}))}if(this.d.form.check=!1,this.d.address.id)return this.saveOrder();this.saveAddress().then((function(t){t&&s.saveOrder()})).catch((function(t){s.d.savingOrder=!1}))}},t.prototype.saveOrder=function(){return Object(r.a)(this,void 0,void 0,(function(){var s,t;return Object(r.d)(this,(function(e){switch(e.label){case 0:return s=Object(r.f)(this.d.cart.items),[4,a.a.post("/order",{address_id:this.d.address.id,userMail:this.d.form.userMail,total:this.d.cart.total,qty:this.d.cart.count,paymentMethod:this.d.paymentMethod,items:s})];case 1:return(t=e.sent())&&t.data&&200===t.status?(this.d.savingOrder=!1,this.d.order=t.data,this.d.order.id=t.data.enc_id,this.d.cart.items.splice(0),this.d.cart.total=0,this.d.cart.count=0,this.success(),[2]):(this.d.savingOrder=!1,this.error(),[2])}}))}))},t.prototype.showTab=function(s){var t=document.getElementById(s);t&&new Tab(t,{height:!0}).show()},t.prototype.beforeMount=function(){this.attachToGlobal(this,["addAddress","updateOrder","selectAddress","addAddress","addOrderWithoutAddress","validateOnChange","showAddressForm","deleteAddress","showTab","storeOrder"])},t.prototype.mounted=function(){var s=this;this.$on("cartDone",(function(){s.d.userId?s.loadAddresses():(s.d.showForm=!0,s.d.addressesLoader=[])})),this.d.form.country="eg",this.d.form.gov="ca"},t=Object(r.b)([d.a],t)}(Object(d.b)(o.a));t.default=c}}]);
//# sourceMappingURL=2.js.map